<img width="1310" height="666" alt="Screenshot 2025-12-31 111738" src="https://github.com/user-attachments/assets/d44a3199-b9ec-4fd5-bb3a-4023d404a08a" />





/* =========================================================
   CUSTOMER SHOPPING BEHAVIOR ANALYSIS
   Dataset: customer_data
   Tool: SQL
   ========================================================= */


/* ---------------------------------------------------------
   Q1. Total revenue generated by male vs female customers
   --------------------------------------------------------- */
SELECT gender, SUM(purchase_amount) AS revenue
FROM customer_data
GROUP BY gender;

/*
| gender | revenue |
|--------|---------|
| Male   | 157890  |
| Female | 75191   |
*/


/* ---------------------------------------------------------
   Q2. Customers who used discounts but spent
       more than the average purchase amount
   --------------------------------------------------------- */
SELECT customer_id, purchase_amount
FROM customer_data
WHERE discount_applied = 'Yes'
  AND purchase_amount >
      (SELECT AVG(purchase_amount) FROM customer_data)
LIMIT 10;

/*
| customer_id | purchase_amount |
|-------------|-----------------|
| 2           | 64              |
| 3           | 73              |
| 4           | 90              |
| 7           | 85              |
| 9           | 97              |
| 12          | 68              |
| 13          | 72              |
| 16          | 81              |
| 20          | 90              |
| 22          | 62              |
*/


/* ---------------------------------------------------------
   Q3. Top 5 products with the highest average review rating
   --------------------------------------------------------- */
SELECT item_purchased,
       ROUND(AVG(review_rating::numeric), 2) AS average_product_rating
FROM customer_data
GROUP BY item_purchased
ORDER BY average_product_rating DESC
LIMIT 5;

/*
| item_purchased | average_product_rating |
|----------------|------------------------|
| Gloves         | 3.86                   |
| Hat            | 3.80                   |
| Jacket         | 3.76                   |
| Sneakers       | 3.76                   |
| Shirt          | 3.62                   |
*/


/* ---------------------------------------------------------
   Q4. Average purchase amount by shipping type
   --------------------------------------------------------- */
SELECT shipping_type,
       ROUND(AVG(purchase_amount), 2) AS avg_purchase
FROM customer_data
WHERE shipping_type IN ('Standard', 'Express')
GROUP BY shipping_type;

/*
| shipping_type | avg_purchase |
|---------------|--------------|
| Express       | 60.48        |
| Standard      | 58.46        |
*/


/* ---------------------------------------------------------
   Q5. Do subscribed customers spend more?
   --------------------------------------------------------- */
SELECT subscription_status,
       COUNT(customer_id) AS total_customers,
       ROUND(AVG(purchase_amount), 2) AS avg_spend,
       ROUND(SUM(purchase_amount), 2) AS total_revenue
FROM customer_data
GROUP BY subscription_status
ORDER BY total_revenue DESC;

/*
| subscription_status | total_customers | avg_spend | total_revenue |
|---------------------|-----------------|-----------|---------------|
| No                  | 2847            | 59.87     | 170436.00     |
| Yes                 | 1053            | 59.49     | 62645.00      |
*/


/* ---------------------------------------------------------
   Q6. Top 5 products with the highest discount rate
   --------------------------------------------------------- */
SELECT item_purchased,
       ROUND(
         100.0 * SUM(CASE WHEN discount_applied = 'Yes' THEN 1 ELSE 0 END)
         / COUNT(*), 2
       ) AS discount_rate
FROM customer_data
GROUP BY item_purchased
ORDER BY discount_rate DESC
LIMIT 5;

/*
| item_purchased | discount_rate (%) |
|----------------|-------------------|
| Hat            | 50.00             |
| Sneakers       | 49.66             |
| Coat           | 49.07             |
| Sweater        | 48.17             |
| Pants          | 47.37             |
*/


/* ---------------------------------------------------------
   Q7. Customer segmentation: New, Returning, Loyal
   --------------------------------------------------------- */
WITH customer_type AS (
  SELECT customer_id,
         CASE
           WHEN previous_purchases <= 1 THEN 'New'
           WHEN previous_purchases BETWEEN 2 AND 10 THEN 'Returning'
           ELSE 'Loyal'
         END AS customer_segment
  FROM customer_data
)
SELECT customer_segment,
       COUNT(*) AS number_of_customers
FROM customer_type
GROUP BY customer_segment;

/*
| customer_segment | number_of_customers |
|------------------|---------------------|
| Loyal            | 3116                |
| Returning        | 701                 |
| New              | 83                  |
*/


/* ---------------------------------------------------------
   Q8. Top 3 most purchased products per category
   --------------------------------------------------------- */
WITH item_counts AS (
  SELECT category,
         item_purchased,
         COUNT(*) AS total_orders,
         ROW_NUMBER() OVER (
           PARTITION BY category
           ORDER BY COUNT(*) DESC
         ) AS item_rank
  FROM customer_data
  GROUP BY category, item_purchased
)
SELECT category, item_purchased, total_orders
FROM item_counts
WHERE item_rank <= 3;

/*
| category    | item_purchased | total_orders |
|-------------|----------------|--------------|
| Accessories | Jewelry        | 171          |
| Accessories | Sunglasses     | 161          |
| Accessories | Belt           | 161          |
| Clothing    | Blouse         | 171          |
| Clothing    | Pants          | 171          |
| Clothing    | Shirt          | 169          |
| Footwear    | Sandals        | 160          |
| Footwear    | Shoes          | 150          |
| Footwear    | Sneakers       | 145          |
| Outerwear   | Jacket         | 163          |
*/


/* ---------------------------------------------------------
   Q9. Repeat buyers (previous purchases > 5) by subscription
   --------------------------------------------------------- */
SELECT subscription_status,
       COUNT(customer_id) AS repeat_buyers
FROM customer_data
WHERE previous_purchases > 5
GROUP BY subscription_status;

/*
| subscription_status | repeat_buyers |
|---------------------|---------------|
| No                  | 2518          |
| Yes                 | 958           |
*/


/* ---------------------------------------------------------
   Q10. Revenue contribution by age group
   --------------------------------------------------------- */
SELECT age_group,
       SUM(purchase_amount) AS total_revenue
FROM customer_data
GROUP BY age_group
ORDER BY total_revenue DESC;

/*
| age_group    | total_revenue |
|--------------|---------------|
| Young Adult  | 62143         |
| Middle-aged  | 59197         |
| Adult        | 55978         |
| Senior       | 55763         |
*/
